<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>CONNECTION (caqti-async.Caqti_async.CONNECTION)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">caqti-async</a> &#x00BB; <a href="../index.html">Caqti_async</a> &#x00BB; CONNECTION</nav><header class="odoc-preamble"><h1>Module type <code><span>Caqti_async.CONNECTION</span></code></h1><p>The connection API specialized for the current concurrency library.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec value" id="val-driver_info" class="anchored"><a href="#val-driver_info" class="anchor"></a><code><span><span class="keyword">val</span> driver_info : <a href="../../../caqti/Caqti_driver_info/index.html#type-t">Caqti_driver_info.t</a></span></code></div><div class="spec-doc"><p>Information about the driver providing this connection module.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-driver_connection" class="anchored"><a href="#val-driver_connection" class="anchor"></a><code><span><span class="keyword">val</span> driver_connection : <span><a href="../../../caqti/Caqti_connection_sig/index.html#type-driver_connection">Caqti_connection_sig.driver_connection</a> option</span></span></code></div><div class="spec-doc"><p>The underlying connection object of the driver if available. The open variant constructor is defined in the driver library. This is currently only implemented for caqti-driver-sqlite3 for the purpose of defining custom functions.</p></div></div><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="../../../caqti/Caqti_connection_sig/module-type-Base/index.html">Caqti_connection_sig.Base</a>
  <span class="keyword">with</span> <span><span class="keyword">type</span> <span>'a <a href="../../../caqti/Caqti_connection_sig/module-type-Base/index.html#type-future">future</a></span> := <span><span class="type-var">'a</span> <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span>
  <span class="keyword">with</span> <span><span class="keyword">type</span> <span>('a, 'err) <a href="../../../caqti/Caqti_connection_sig/module-type-Base/index.html#type-stream">stream</a></span> := <span><span>( <span class="type-var">'a</span>, <span class="type-var">'err</span> )</span> <a href="../Stream/index.html#type-t">Stream.t</a></span></span></span></code></summary><h3 id="query"><a href="#query" class="anchor"></a>Query</h3><div class="odoc-spec"><div class="spec module" id="module-Response" class="anchored"><a href="#module-Response" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Response/index.html">Response</a></span><span> : 
  <a href="../../../caqti/Caqti_response_sig/module-type-S/index.html">Caqti_response_sig.S</a>
    <span class="keyword">with</span> <span><span class="keyword">type</span> <span>'a <a href="../../../caqti/Caqti_response_sig/module-type-S/index.html#type-future">future</a></span> := <span><span class="type-var">'a</span> <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <span>('a, 'err) <a href="../../../caqti/Caqti_response_sig/module-type-S/index.html#type-stream">stream</a></span> := <span><span>( <span class="type-var">'a</span>, <span class="type-var">'err</span> )</span> <a href="../Stream/index.html#type-t">Stream.t</a></span></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-call" class="anchored"><a href="#val-call" class="anchor"></a><code><span><span class="keyword">val</span> call : 
  <span>f:
    <span>( <span><span><span>( <span class="type-var">'b</span>, <span class="type-var">'m</span> )</span> <a href="Response/index.html#type-t">Response.t</a></span> <span class="arrow">&#45;&gt;</span></span>
      <span><span><span>( <span class="type-var">'c</span>, <span class="type-var">'e</span> )</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'m</span> )</span> <a href="../../../caqti/Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <span class="type-var">'c</span>, <span>[&gt; <a href="../../../caqti/Caqti_error/index.html#type-call">Caqti_error.call</a> ]</span> <span class="keyword">as</span> 'e )</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p><code>call ~f request params</code> performs <code>request</code> with parameters <code>params</code> invoking <code>f</code> to process the result. The argument of <code>f</code> is only valid during the call to <code>f</code>, and must not be returned or operated on by other threads.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-set_statement_timeout" class="anchored"><a href="#val-set_statement_timeout" class="anchor"></a><code><span><span class="keyword">val</span> set_statement_timeout : 
  <span><span>float option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( unit, <span>[&gt; <a href="../../../caqti/Caqti_error/index.html#type-call">Caqti_error.call</a> ]</span> )</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p>Set or clear the timeout after which a running SQL statement will be terminated if supported by the driver. This is currently supported for MariaDB (using <code>max_statement_time</code>) and PostgreSQL (using <code>statement_timeout</code>) and has no effect for SQLite3.</p></div></div><h3 id="transactions"><a href="#transactions" class="anchor"></a>Transactions</h3><div class="odoc-spec"><div class="spec value" id="val-start" class="anchored"><a href="#val-start" class="anchor"></a><code><span><span class="keyword">val</span> start : 
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( unit, <span>[&gt; <a href="../../../caqti/Caqti_error/index.html#type-transact">Caqti_error.transact</a> ]</span> )</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p>Starts a transaction if supported by the underlying database, otherwise does nothing.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-commit" class="anchored"><a href="#val-commit" class="anchor"></a><code><span><span class="keyword">val</span> commit : 
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( unit, <span>[&gt; <a href="../../../caqti/Caqti_error/index.html#type-transact">Caqti_error.transact</a> ]</span> )</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p>Commits the current transaction if supported by the underlying database, otherwise does nothing.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-rollback" class="anchored"><a href="#val-rollback" class="anchor"></a><code><span><span class="keyword">val</span> rollback : 
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( unit, <span>[&gt; <a href="../../../caqti/Caqti_error/index.html#type-transact">Caqti_error.transact</a> ]</span> )</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p>Rolls back a transaction if supported by the underlying database, otherwise does nothing.</p></div></div><h3 id="disconnection-and-reuse"><a href="#disconnection-and-reuse" class="anchor"></a>Disconnection and Reuse</h3><div class="odoc-spec"><div class="spec value" id="val-deallocate" class="anchored"><a href="#val-deallocate" class="anchor"></a><code><span><span class="keyword">val</span> deallocate : 
  <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'m</span> )</span> <a href="../../../caqti/Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( unit, <span>[&gt; <a href="../../../caqti/Caqti_error/index.html#type-call">Caqti_error.call</a> ]</span> )</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p><code>deallocate req</code> deallocates the prepared query for <code>req</code> if it was allocated. The request must not be oneshot.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-disconnect" class="anchored"><a href="#val-disconnect" class="anchor"></a><code><span><span class="keyword">val</span> disconnect : <span>unit <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p>Calling <code>disconnect ()</code> closes the connection to the database and frees up related resources.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-validate" class="anchored"><a href="#val-validate" class="anchor"></a><code><span><span class="keyword">val</span> validate : <span>unit <span class="arrow">&#45;&gt;</span></span> <span>bool <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p>For internal use by <a href="../../../caqti/Caqti_pool/index.html"><code>Caqti_pool</code></a>. Tries to ensure the validity of the connection and must return <code>false</code> if unsuccessful.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-check" class="anchored"><a href="#val-check" class="anchor"></a><code><span><span class="keyword">val</span> check : <span><span>( <span>bool <span class="arrow">&#45;&gt;</span></span> unit )</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>For internal use by <a href="../../../caqti/Caqti_pool/index.html"><code>Caqti_pool</code></a>. Called after a connection has been used. <code>check f</code> must call <code>f ()</code> exactly once with an argument indicating whether to keep the connection in the pool or discard it.</p></div></div></details></div><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="../../../caqti/Caqti_connection_sig/module-type-Convenience/index.html">Caqti_connection_sig.Convenience</a>
  <span class="keyword">with</span> <span><span class="keyword">type</span> <span>'a <a href="../../../caqti/Caqti_connection_sig/module-type-Convenience/index.html#type-future">future</a></span> := <span><span class="type-var">'a</span> <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></span></code></summary><h3 id="retrieval-convenience"><a href="#retrieval-convenience" class="anchor"></a>Retrieval Convenience</h3><p>These are shortcuts for <a href="#val-call"><code>call</code></a> combined with retrieval functions from <a href="../../../caqti/Caqti_response_sig/module-type-S/index.html"><code>Caqti_response_sig.S</code></a> of the same name.</p><div class="odoc-spec"><div class="spec value" id="val-exec" class="anchored"><a href="#val-exec" class="anchor"></a><code><span><span class="keyword">val</span> exec : 
  <span><span><span>( <span class="type-var">'a</span>, unit, <span>[&lt; `Zero ]</span> )</span> <a href="../../../caqti/Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( unit, <span>[&gt; <a href="../../../caqti/Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e )</span> <span class="xref-unresolved">Stdlib</span>.result</span>
    <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p>Combining <a href="#val-call"><code>call</code></a> with <a href="Response/index.html#val-exec"><code>Response.exec</code></a>, this sends a request to the database and checks that no rows are returned.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-exec_with_affected_count" class="anchored"><a href="#val-exec_with_affected_count" class="anchor"></a><code><span><span class="keyword">val</span> exec_with_affected_count : 
  <span><span><span>( <span class="type-var">'a</span>, unit, <span>[&lt; `Zero ]</span> )</span> <a href="../../../caqti/Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( int, <span>[&gt; <a href="../../../caqti/Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e )</span> <span class="xref-unresolved">Stdlib</span>.result</span>
    <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p>Combining <a href="#val-call"><code>call</code></a> with <a href="Response/index.html#val-exec"><code>Response.exec</code></a> and <a href="Response/index.html#val-affected_count"><code>Response.affected_count</code></a>, this sends a request to the database, checks that no rows are returned and returns the number of affected rows.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-find" class="anchored"><a href="#val-find" class="anchor"></a><code><span><span class="keyword">val</span> find : 
  <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `One ]</span> )</span> <a href="../../../caqti/Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <span class="type-var">'b</span>, <span>[&gt; <a href="../../../caqti/Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e )</span> <span class="xref-unresolved">Stdlib</span>.result</span>
    <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p>Combining <a href="#val-call"><code>call</code></a> with <a href="Response/index.html#val-find"><code>Response.find</code></a>, this sends a request to the database, checks that a single row is returned, and extracts it.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-find_opt" class="anchored"><a href="#val-find_opt" class="anchor"></a><code><span><span class="keyword">val</span> find_opt : 
  <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `Zero <span>| `One</span> ]</span> )</span> <a href="../../../caqti/Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <span><span class="type-var">'b</span> option</span>, <span>[&gt; <a href="../../../caqti/Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e )</span> <span class="xref-unresolved">Stdlib</span>.result</span>
    <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p>Combining <a href="#val-call"><code>call</code></a> with <a href="Response/index.html#val-find_opt"><code>Response.find_opt</code></a>, this sends a request to the database, checks that at most one row is returned, and extracts it if present.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-fold" class="anchored"><a href="#val-fold" class="anchor"></a><code><span><span class="keyword">val</span> fold : 
  <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `Zero <span>| `One</span> <span>| `Many</span> ]</span> )</span> <a href="../../../caqti/Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'c</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'c</span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'c</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <span class="type-var">'c</span>, <span>[&gt; <a href="../../../caqti/Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e )</span> <span class="xref-unresolved">Stdlib</span>.result</span>
    <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p>Combining <a href="#val-call"><code>call</code></a> with <a href="Response/index.html#val-fold"><code>Response.fold</code></a>, this sends a request to the database and folds over the result rows.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-fold_s" class="anchored"><a href="#val-fold_s" class="anchor"></a><code><span><span class="keyword">val</span> fold_s : 
  <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `Zero <span>| `One</span> <span>| `Many</span> ]</span> )</span> <a href="../../../caqti/Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'c</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>( <span class="type-var">'c</span>, <span class="type-var">'e</span> )</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'c</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <span class="type-var">'c</span>, <span>[&gt; <a href="../../../caqti/Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e )</span> <span class="xref-unresolved">Stdlib</span>.result</span>
    <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p>Combining <a href="#val-call"><code>call</code></a> with <a href="Response/index.html#val-fold_s"><code>Response.fold_s</code></a>, this sends a request to the database and folds sequentially over the result rows in a non-blocking manner.</p><p>Please be aware of possible deadlocks when using resources from the callback. In particular, if the same connection pool is invoked as the one used to obtain the current connection, it will deadlock if the pool has just run out of connections. An alternative is to collect the rows first e.g. with <a href="#val-fold"><code>fold</code></a> and do the nested queries after exiting.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-iter_s" class="anchored"><a href="#val-iter_s" class="anchor"></a><code><span><span class="keyword">val</span> iter_s : 
  <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `Zero <span>| `One</span> <span>| `Many</span> ]</span> )</span> <a href="../../../caqti/Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>( unit, <span class="type-var">'e</span> )</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( unit, <span>[&gt; <a href="../../../caqti/Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e )</span> <span class="xref-unresolved">Stdlib</span>.result</span>
    <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p>Combining <a href="#val-call"><code>call</code></a> with <a href="Response/index.html#val-iter_s"><code>Response.iter_s</code></a>, this sends a request to the database and iterates sequentially over the result rows in a non-blocking manner. Please see the warning in <a href="#val-fold_s"><code>fold_s</code></a> about resource usage in the callback.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-collect_list" class="anchored"><a href="#val-collect_list" class="anchor"></a><code><span><span class="keyword">val</span> collect_list : 
  <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `Zero <span>| `One</span> <span>| `Many</span> ]</span> )</span> <a href="../../../caqti/Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <span><span class="type-var">'b</span> list</span>, <span>[&gt; <a href="../../../caqti/Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e )</span> <span class="xref-unresolved">Stdlib</span>.result</span>
    <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p><code>collect_list request param</code> performs a <a href="#val-call"><code>call</code></a> on <code>request</code>, extracting the result as a list.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-rev_collect_list" class="anchored"><a href="#val-rev_collect_list" class="anchor"></a><code><span><span class="keyword">val</span> rev_collect_list : 
  <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `Zero <span>| `One</span> <span>| `Many</span> ]</span> )</span> <a href="../../../caqti/Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <span><span class="type-var">'b</span> list</span>, <span>[&gt; <a href="../../../caqti/Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e )</span> <span class="xref-unresolved">Stdlib</span>.result</span>
    <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p><code>rev_collect_list request param</code> performs a <a href="#val-call"><code>call</code></a> on <code>request</code>, extracting the result as a reversed list. This is more efficient than <a href="#val-collect_list"><code>collect_list</code></a> and fits well with a subsequent <code>List</code>.rev_map, though it may not matter much in practise.</p></div></div><h3 id="transactions_2"><a href="#transactions_2" class="anchor"></a>Transactions</h3><div class="odoc-spec"><div class="spec value" id="val-with_transaction" class="anchored"><a href="#val-with_transaction" class="anchor"></a><code><span><span class="keyword">val</span> with_transaction : 
  <span><span>( <span>unit <span class="arrow">&#45;&gt;</span></span> <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'e</span> )</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <span class="type-var">'a</span>, <span>[&gt; <a href="../../../caqti/Caqti_error/index.html#type-transact">Caqti_error.transact</a> ]</span> <span class="keyword">as</span> 'e )</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p><code>with_transaction f</code> wraps <code>f</code> in a transaction which is committed iff <code>f</code> returns <code>Ok _</code>.</p></div></div></details></div><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="../../../caqti/Caqti_connection_sig/module-type-Populate/index.html">Caqti_connection_sig.Populate</a>
  <span class="keyword">with</span> <span><span class="keyword">type</span> <span>'a <a href="../../../caqti/Caqti_connection_sig/module-type-Populate/index.html#type-future">future</a></span> := <span><span class="type-var">'a</span> <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span>
   <span class="keyword">and</span> <span><span class="keyword">type</span> <span>('a, 'err) <a href="../../../caqti/Caqti_connection_sig/module-type-Populate/index.html#type-stream">stream</a></span> := <span><span>( <span class="type-var">'a</span>, <span class="type-var">'err</span> )</span> <a href="../Stream/index.html#type-t">Stream.t</a></span></span></span></code></summary><h3 id="insertion"><a href="#insertion" class="anchor"></a>Insertion</h3><div class="odoc-spec"><div class="spec value" id="val-populate" class="anchored"><a href="#val-populate" class="anchor"></a><code><span><span class="keyword">val</span> populate : 
  <span>table:string <span class="arrow">&#45;&gt;</span></span>
  <span>columns:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../../../caqti/Caqti_type/index.html#type-t">Caqti_type.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'err</span> )</span> <a href="../Stream/index.html#type-t">Stream.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( unit, <span>[&gt; <a href="../../../caqti/Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> <span><span>| `Congested</span> of <span class="type-var">'err</span></span> ]</span> )</span>
    <span class="xref-unresolved">Stdlib</span>.result</span>
    <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p><code>populate table columns row_type seq</code> inputs the contents of <code>seq</code> into the database in whatever manner is most efficient as decided by the driver.</p></div></div></details></div></div></body></html>