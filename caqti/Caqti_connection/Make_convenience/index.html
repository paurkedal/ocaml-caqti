<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Make_convenience (caqti.Caqti_connection.Make_convenience)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../index.html">caqti</a> &#x00BB; <a href="../index.html">Caqti_connection</a> &#x00BB; Make_convenience</nav><h1>Module <code>Caqti_connection.Make_convenience</code></h1><nav class="toc"><ul><li><a href="#retrieval-convenience">Retrieval Convenience</a></li></ul></nav></header><h3 class="heading">Parameters</h3><ul><li><code><a href="argument-1-Sys/index.html">Sys</a> : <a href="../../Caqti_driver_sig/index.html#module-type-System_common">Caqti_driver_sig.System_common</a></code></li><li><code><a href="argument-2-C/index.html">C</a> : <a href="../../Caqti_connection_sig/index.html#module-type-Base">Caqti_connection_sig.Base</a> <span class="keyword">with</span> <span class="keyword">type</span> <span>'a <a href="argument-2-C/index.html#type-future">future</a></span> := <span><span class="type-var">'a</span> <a href="argument-1-Sys/index.html#type-future">Sys.future</a></span> <span class="keyword">and</span> <span class="keyword">type</span> <span>('a, 'err) <a href="argument-2-C/index.html#type-stream">stream</a></span> := <span><span>(<span class="type-var">'a</span>, <span class="type-var">'err</span>)</span> <a href="argument-1-Sys/Stream/index.html#type-t">Sys.Stream.t</a></span></code></li></ul><h3 class="heading">Signature</h3><dl><dt class="spec type" id="type-future"><a href="#type-future" class="anchor"></a><code><span class="keyword">type</span> <span>+'a future</span></code></dt></dl><section><header><h3 id="retrieval-convenience"><a href="#retrieval-convenience" class="anchor"></a>Retrieval Convenience</h3><p>These are shortcuts for <code>call</code> combined with retrieval functions from <a href="../../Caqti_response_sig/module-type-S/index.html"><code>Caqti_response_sig.S</code></a> of the same name.</p></header><dl><dt class="spec value" id="val-exec"><a href="#val-exec" class="anchor"></a><code><span class="keyword">val</span> exec : <span><span>(<span class="type-var">'a</span>, unit, <span>[&lt; `Zero ]</span>)</span> <a href="../../Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span><span><span>(unit, <span>[&gt; <a href="../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e)</span> Stdlib.result</span> <a href="index.html#type-future">future</a></span></code></dt><dd><p>Combining <code>call</code> with <span class="xref-unresolved" title="unresolved reference to &quot;Response.exec&quot;"><code>Response</code>.exec</span>, this sends a request to the database and checks that no rows are returned.</p></dd></dl><dl><dt class="spec value" id="val-exec_with_affected_count"><a href="#val-exec_with_affected_count" class="anchor"></a><code><span class="keyword">val</span> exec_with_affected_count : <span><span>(<span class="type-var">'a</span>, unit, <span>[&lt; `Zero ]</span>)</span> <a href="../../Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span><span><span>(int, <span>[&gt; <a href="../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e)</span> Stdlib.result</span> <a href="index.html#type-future">future</a></span></code></dt><dd><p>Combining <code>call</code> with <span class="xref-unresolved" title="unresolved reference to &quot;Response.exec&quot;"><code>Response</code>.exec</span> and <span class="xref-unresolved" title="unresolved reference to &quot;Response.affected_count&quot;"><code>Response</code>.affected_count</span>, this sends a request to the database, checks that no rows are returned and returns the number of affected rows.</p></dd></dl><dl><dt class="spec value" id="val-find"><a href="#val-find" class="anchor"></a><code><span class="keyword">val</span> find : <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `One ]</span>)</span> <a href="../../Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span><span><span>(<span class="type-var">'b</span>, <span>[&gt; <a href="../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e)</span> Stdlib.result</span> <a href="index.html#type-future">future</a></span></code></dt><dd><p>Combining <code>call</code> with <span class="xref-unresolved" title="unresolved reference to &quot;Response.find&quot;"><code>Response</code>.find</span>, this sends a request to the database, checks that a single row is returned, and extracts it.</p></dd></dl><dl><dt class="spec value" id="val-find_opt"><a href="#val-find_opt" class="anchor"></a><code><span class="keyword">val</span> find_opt : <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `Zero <span>| `One</span> ]</span>)</span> <a href="../../Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span><span><span>(<span><span class="type-var">'b</span> option</span>, <span>[&gt; <a href="../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e)</span> Stdlib.result</span> <a href="index.html#type-future">future</a></span></code></dt><dd><p>Combining <code>call</code> with <span class="xref-unresolved" title="unresolved reference to &quot;Response.find_opt&quot;"><code>Response</code>.find_opt</span>, this sends a request to the database, checks that at most one row is returned, and extracts it if present.</p></dd></dl><dl><dt class="spec value" id="val-fold"><a href="#val-fold" class="anchor"></a><code><span class="keyword">val</span> fold : <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `Zero <span>| `One</span> <span>| `Many</span> ]</span>)</span> <a href="../../Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span>&#45;&gt;</span> <span>(<span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'c</span> <span>&#45;&gt;</span> <span class="type-var">'c</span>)</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'c</span> <span>&#45;&gt;</span> <span><span><span>(<span class="type-var">'c</span>, <span>[&gt; <a href="../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e)</span> Stdlib.result</span> <a href="index.html#type-future">future</a></span></code></dt><dd><p>Combining <code>call</code> with <span class="xref-unresolved" title="unresolved reference to &quot;Response.fold&quot;"><code>Response</code>.fold</span>, this sends a request to the database and folds over the result rows.</p></dd></dl><dl><dt class="spec value" id="val-fold_s"><a href="#val-fold_s" class="anchor"></a><code><span class="keyword">val</span> fold_s : <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `Zero <span>| `One</span> <span>| `Many</span> ]</span>)</span> <a href="../../Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span>&#45;&gt;</span> <span>(<span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'c</span> <span>&#45;&gt;</span> <span><span><span>(<span class="type-var">'c</span>, <span class="type-var">'e</span>)</span> Stdlib.result</span> <a href="index.html#type-future">future</a></span>)</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'c</span> <span>&#45;&gt;</span> <span><span><span>(<span class="type-var">'c</span>, <span>[&gt; <a href="../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e)</span> Stdlib.result</span> <a href="index.html#type-future">future</a></span></code></dt><dd><p>Combining <code>call</code> with <span class="xref-unresolved" title="unresolved reference to &quot;Response.fold_s&quot;"><code>Response</code>.fold_s</span>, this sends a request to the database and folds sequentially over the result rows in a non-blocking manner.</p><p>Please be aware of possible deadlocks when using resources from the callback. In particular, if the same connection pool is invoked as the one used to obtain the current connection, it will deadlock if the pool has just run out of connections. An alternative is to collect the rows first e.g. with <a href="index.html#val-fold"><code>fold</code></a> and do the nested queries after exiting.</p></dd></dl><dl><dt class="spec value" id="val-iter_s"><a href="#val-iter_s" class="anchor"></a><code><span class="keyword">val</span> iter_s : <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `Zero <span>| `One</span> <span>| `Many</span> ]</span>)</span> <a href="../../Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span>&#45;&gt;</span> <span>(<span class="type-var">'b</span> <span>&#45;&gt;</span> <span><span><span>(unit, <span class="type-var">'e</span>)</span> Stdlib.result</span> <a href="index.html#type-future">future</a></span>)</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span><span><span>(unit, <span>[&gt; <a href="../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e)</span> Stdlib.result</span> <a href="index.html#type-future">future</a></span></code></dt><dd><p>Combining <code>call</code> with <span class="xref-unresolved" title="unresolved reference to &quot;Response.iter_s&quot;"><code>Response</code>.iter_s</span>, this sends a request to the database and iterates sequentially over the result rows in a non-blocking manner. Please see the warning in <a href="index.html#val-fold_s"><code>fold_s</code></a> about resource usage in the callback.</p></dd></dl><dl><dt class="spec value" id="val-collect_list"><a href="#val-collect_list" class="anchor"></a><code><span class="keyword">val</span> collect_list : <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `Zero <span>| `One</span> <span>| `Many</span> ]</span>)</span> <a href="../../Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span><span><span>(<span><span class="type-var">'b</span> list</span>, <span>[&gt; <a href="../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e)</span> Stdlib.result</span> <a href="index.html#type-future">future</a></span></code></dt><dd><p><code>collect_list request param</code> performs a <code>call</code> on <code>request</code>, extracting the result as a list.</p></dd></dl><dl><dt class="spec value" id="val-rev_collect_list"><a href="#val-rev_collect_list" class="anchor"></a><code><span class="keyword">val</span> rev_collect_list : <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `Zero <span>| `One</span> <span>| `Many</span> ]</span>)</span> <a href="../../Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span><span><span>(<span><span class="type-var">'b</span> list</span>, <span>[&gt; <a href="../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e)</span> Stdlib.result</span> <a href="index.html#type-future">future</a></span></code></dt><dd><p><code>rev_collect_list request param</code> performs a <code>call</code> on <code>request</code>, extracting the result as a reversed list. This is more efficient than <a href="index.html#val-collect_list"><code>collect_list</code></a> and fits well with a subsequent <span class="xref-unresolved" title="unresolved reference to &quot;List.rev_map&quot;"><code>List</code>.rev_map</span>, though it may not matter much in practise.</p></dd></dl></section></div></body></html>