<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Make_convenience (caqti.Caqti_connection.Make_convenience)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">caqti</a> &#x00BB; <a href="../index.html">Caqti_connection</a> &#x00BB; Make_convenience</nav><header class="odoc-preamble"><h1>Module <code><span>Caqti_connection.Make_convenience</span></code></h1></header><nav class="odoc-toc"><ul><li><a href="#parameters">Parameters</a></li><li><a href="#signature">Signature</a><ul><li><a href="#retrieval-convenience">Retrieval Convenience</a></li><li><a href="#transactions_2">Transactions</a></li></ul></li></ul></nav><div class="odoc-content"><h2 id="parameters"><a href="#parameters" class="anchor"></a>Parameters</h2><div class="odoc-spec"><div class="spec parameter" id="argument-1-Sys" class="anchored"><a href="#argument-1-Sys" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="argument-1-Sys/index.html">Sys</a></span><span> : <a href="../../Caqti_driver_sig/module-type-System_common/index.html">Caqti_driver_sig.System_common</a></span></code></div></div><div class="odoc-spec"><div class="spec parameter" id="argument-2-C" class="anchored"><a href="#argument-2-C" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="argument-2-C/index.html">C</a></span><span> : 
  <a href="../../Caqti_connection_sig/module-type-Base/index.html">Caqti_connection_sig.Base</a>
    <span class="keyword">with</span> <span><span class="keyword">type</span> <span>'a <a href="../../Caqti_connection_sig/module-type-Base/index.html#type-future">future</a></span> := <span><span class="type-var">'a</span> <a href="argument-1-Sys/index.html#type-future">Sys.future</a></span></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <span>('a, 'err) <a href="../../Caqti_connection_sig/module-type-Base/index.html#type-stream">stream</a></span> := <span><span>( <span class="type-var">'a</span>, <span class="type-var">'err</span> )</span> <a href="argument-1-Sys/Stream/index.html#type-t">Sys.Stream.t</a></span></span></span></code></div></div><h2 id="signature"><a href="#signature" class="anchor"></a>Signature</h2><h3 id="retrieval-convenience"><a href="#retrieval-convenience" class="anchor"></a>Retrieval Convenience</h3><p>These are shortcuts for <code>call</code> combined with retrieval functions from <a href="../../Caqti_response_sig/module-type-S/index.html"><code>Caqti_response_sig.S</code></a> of the same name.</p><div class="odoc-spec"><div class="spec value" id="val-exec" class="anchored"><a href="#val-exec" class="anchor"></a><code><span><span class="keyword">val</span> exec : 
  <span><span><span>( <span class="type-var">'a</span>, unit, <span>[&lt; `Zero ]</span> )</span> <a href="../../Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( unit, <span>[&gt; <a href="../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e )</span> <span class="xref-unresolved">Stdlib</span>.result</span> <a href="argument-1-Sys/index.html#type-future">Sys.future</a></span></span></code></div><div class="spec-doc"><p>Combining <code>call</code> with <code>Response</code>.exec, this sends a request to the database and checks that no rows are returned.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-exec_with_affected_count" class="anchored"><a href="#val-exec_with_affected_count" class="anchor"></a><code><span><span class="keyword">val</span> exec_with_affected_count : 
  <span><span><span>( <span class="type-var">'a</span>, unit, <span>[&lt; `Zero ]</span> )</span> <a href="../../Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( int, <span>[&gt; <a href="../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e )</span> <span class="xref-unresolved">Stdlib</span>.result</span> <a href="argument-1-Sys/index.html#type-future">Sys.future</a></span></span></code></div><div class="spec-doc"><p>Combining <code>call</code> with <code>Response</code>.exec and <code>Response</code>.affected_count, this sends a request to the database, checks that no rows are returned and returns the number of affected rows.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-find" class="anchored"><a href="#val-find" class="anchor"></a><code><span><span class="keyword">val</span> find : 
  <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `One ]</span> )</span> <a href="../../Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <span class="type-var">'b</span>, <span>[&gt; <a href="../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e )</span> <span class="xref-unresolved">Stdlib</span>.result</span> <a href="argument-1-Sys/index.html#type-future">Sys.future</a></span></span></code></div><div class="spec-doc"><p>Combining <code>call</code> with <code>Response</code>.find, this sends a request to the database, checks that a single row is returned, and extracts it.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-find_opt" class="anchored"><a href="#val-find_opt" class="anchor"></a><code><span><span class="keyword">val</span> find_opt : 
  <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `Zero <span>| `One</span> ]</span> )</span> <a href="../../Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <span><span class="type-var">'b</span> option</span>, <span>[&gt; <a href="../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e )</span> <span class="xref-unresolved">Stdlib</span>.result</span>
    <a href="argument-1-Sys/index.html#type-future">Sys.future</a></span></span></code></div><div class="spec-doc"><p>Combining <code>call</code> with <code>Response</code>.find_opt, this sends a request to the database, checks that at most one row is returned, and extracts it if present.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-fold" class="anchored"><a href="#val-fold" class="anchor"></a><code><span><span class="keyword">val</span> fold : 
  <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `Zero <span>| `One</span> <span>| `Many</span> ]</span> )</span> <a href="../../Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'c</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'c</span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'c</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <span class="type-var">'c</span>, <span>[&gt; <a href="../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e )</span> <span class="xref-unresolved">Stdlib</span>.result</span> <a href="argument-1-Sys/index.html#type-future">Sys.future</a></span></span></code></div><div class="spec-doc"><p>Combining <code>call</code> with <code>Response</code>.fold, this sends a request to the database and folds over the result rows.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-fold_s" class="anchored"><a href="#val-fold_s" class="anchor"></a><code><span><span class="keyword">val</span> fold_s : 
  <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `Zero <span>| `One</span> <span>| `Many</span> ]</span> )</span> <a href="../../Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'c</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>( <span class="type-var">'c</span>, <span class="type-var">'e</span> )</span> <span class="xref-unresolved">Stdlib</span>.result</span> <a href="argument-1-Sys/index.html#type-future">Sys.future</a></span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'c</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <span class="type-var">'c</span>, <span>[&gt; <a href="../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e )</span> <span class="xref-unresolved">Stdlib</span>.result</span> <a href="argument-1-Sys/index.html#type-future">Sys.future</a></span></span></code></div><div class="spec-doc"><p>Combining <code>call</code> with <code>Response</code>.fold_s, this sends a request to the database and folds sequentially over the result rows in a non-blocking manner.</p><p>Please be aware of possible deadlocks when using resources from the callback. In particular, if the same connection pool is invoked as the one used to obtain the current connection, it will deadlock if the pool has just run out of connections. An alternative is to collect the rows first e.g. with <a href="#val-fold"><code>fold</code></a> and do the nested queries after exiting.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-iter_s" class="anchored"><a href="#val-iter_s" class="anchor"></a><code><span><span class="keyword">val</span> iter_s : 
  <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `Zero <span>| `One</span> <span>| `Many</span> ]</span> )</span> <a href="../../Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>( unit, <span class="type-var">'e</span> )</span> <span class="xref-unresolved">Stdlib</span>.result</span> <a href="argument-1-Sys/index.html#type-future">Sys.future</a></span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( unit, <span>[&gt; <a href="../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e )</span> <span class="xref-unresolved">Stdlib</span>.result</span> <a href="argument-1-Sys/index.html#type-future">Sys.future</a></span></span></code></div><div class="spec-doc"><p>Combining <code>call</code> with <code>Response</code>.iter_s, this sends a request to the database and iterates sequentially over the result rows in a non-blocking manner. Please see the warning in <a href="#val-fold_s"><code>fold_s</code></a> about resource usage in the callback.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-collect_list" class="anchored"><a href="#val-collect_list" class="anchor"></a><code><span><span class="keyword">val</span> collect_list : 
  <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `Zero <span>| `One</span> <span>| `Many</span> ]</span> )</span> <a href="../../Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <span><span class="type-var">'b</span> list</span>, <span>[&gt; <a href="../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e )</span> <span class="xref-unresolved">Stdlib</span>.result</span> <a href="argument-1-Sys/index.html#type-future">Sys.future</a></span></span></code></div><div class="spec-doc"><p><code>collect_list request param</code> performs a <code>call</code> on <code>request</code>, extracting the result as a list.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-rev_collect_list" class="anchored"><a href="#val-rev_collect_list" class="anchor"></a><code><span><span class="keyword">val</span> rev_collect_list : 
  <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `Zero <span>| `One</span> <span>| `Many</span> ]</span> )</span> <a href="../../Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <span><span class="type-var">'b</span> list</span>, <span>[&gt; <a href="../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e )</span> <span class="xref-unresolved">Stdlib</span>.result</span> <a href="argument-1-Sys/index.html#type-future">Sys.future</a></span></span></code></div><div class="spec-doc"><p><code>rev_collect_list request param</code> performs a <code>call</code> on <code>request</code>, extracting the result as a reversed list. This is more efficient than <a href="#val-collect_list"><code>collect_list</code></a> and fits well with a subsequent <code>List</code>.rev_map, though it may not matter much in practise.</p></div></div><h3 id="transactions_2"><a href="#transactions_2" class="anchor"></a>Transactions</h3><div class="odoc-spec"><div class="spec value" id="val-with_transaction" class="anchored"><a href="#val-with_transaction" class="anchor"></a><code><span><span class="keyword">val</span> with_transaction : 
  <span><span>( <span>unit <span class="arrow">&#45;&gt;</span></span> <span><span><span>( <span class="type-var">'a</span>, <span class="type-var">'e</span> )</span> <span class="xref-unresolved">Stdlib</span>.result</span> <a href="argument-1-Sys/index.html#type-future">Sys.future</a></span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <span class="type-var">'a</span>, <span>[&gt; <a href="../../Caqti_error/index.html#type-transact">Caqti_error.transact</a> ]</span> <span class="keyword">as</span> 'e )</span> <span class="xref-unresolved">Stdlib</span>.result</span> <a href="argument-1-Sys/index.html#type-future">Sys.future</a></span></span></code></div><div class="spec-doc"><p><code>with_transaction f</code> wraps <code>f</code> in a transaction which is committed iff <code>f</code> returns <code>Ok _</code>.</p></div></div></div></body></html>