<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>CONNECTION (caqti-async.Caqti_async.CONNECTION)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">caqti-async</a> &#x00BB; <a href="../index.html">Caqti_async</a> &#x00BB; CONNECTION</nav><header class="odoc-preamble"><h1>Module type <code><span>Caqti_async.CONNECTION</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec value anchored" id="val-driver_info"><a href="#val-driver_info" class="anchor"></a><code><span><span class="keyword">val</span> driver_info : <a href="../../../caqti/Caqti_driver_info/index.html#type-t">Caqti_driver_info.t</a></span></code></div><div class="spec-doc"><p>Information about the driver providing this connection module.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-driver_connection"><a href="#val-driver_connection" class="anchor"></a><code><span><span class="keyword">val</span> driver_connection : <span><a href="../../../caqti/Caqti_connection_sig/index.html#type-driver_connection">Caqti_connection_sig.driver_connection</a> option</span></span></code></div><div class="spec-doc"><p>The underlying connection object of the driver if available. The open variant constructor is defined in the driver library. This is currently only implemented for caqti-driver-sqlite3 for the purpose of defining custom functions.</p></div></div><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="../../../caqti/Caqti_connection_sig/module-type-Base/index.html">Caqti_connection_sig.Base</a>
  <span class="keyword">with</span> <span><span class="keyword">type</span> <span>'a <a href="../../../caqti/Caqti_connection_sig/module-type-Base/index.html#type-fiber">fiber</a></span> := <span><span class="type-var">'a</span> <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span>
  <span class="keyword">with</span> <span><span class="keyword">type</span> <span>('a, 'e) <a href="../../../caqti/Caqti_connection_sig/module-type-Base/index.html#type-stream">stream</a></span> := <span><span>(<span class="type-var">'a</span>, <span class="type-var">'e</span>)</span> <a href="../Stream/index.html#type-t">Stream.t</a></span></span></span></code></summary><h3 id="query"><a href="#query" class="anchor"></a>Query</h3><div class="odoc-spec"><div class="spec module anchored" id="module-Response"><a href="#module-Response" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Response/index.html">Response</a></span><span> : 
  <a href="../../../caqti/Caqti_response_sig/module-type-S/index.html">Caqti_response_sig.S</a>
    <span class="keyword">with</span> <span><span class="keyword">type</span> <span>'a <a href="../../../caqti/Caqti_response_sig/module-type-S/index.html#type-fiber">fiber</a></span> := <span><span class="type-var">'a</span> <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <span>('a, 'err) <a href="../../../caqti/Caqti_response_sig/module-type-S/index.html#type-stream">stream</a></span> := <span><span>(<span class="type-var">'a</span>, <span class="type-var">'err</span>)</span> <a href="../Stream/index.html#type-t">Stream.t</a></span></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-call"><a href="#val-call" class="anchor"></a><code><span><span class="keyword">val</span> call : 
  <span><span class="label">f</span>:<span>(<span><span><span>(<span class="type-var">'b</span>, <span class="type-var">'m</span>)</span> <a href="Response/index.html#type-t">Response.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'c</span>, <span class="type-var">'e</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'m</span>)</span> <a href="../../../caqti/Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'c</span>, <span>[&gt; <a href="../../../caqti/Caqti_error/index.html#type-call">Caqti_error.call</a> ]</span> <span class="keyword">as</span> 'e)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p><code>call ~f request params</code> executes <code>request</code> with parameters <code>params</code> invoking <code>f</code> to process the result; except the driver may postpone the request until <code>f</code> attempts to retrieve the result.</p><p>One of the <a href="Response/index.html#result_retrieval" title="result_retrieval">result retrieval</a> functions must be called exactly once before <code>f</code> returns a non-error result. If a result retrieval function is not called, it is unspecified whether the database query has been issued.</p><p>The argument of <code>f</code> is only valid during the call to <code>f</code>, and must not be returned or operated on by other threads.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_statement_timeout"><a href="#val-set_statement_timeout" class="anchor"></a><code><span><span class="keyword">val</span> set_statement_timeout : 
  <span><span>float option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(unit, <span>[&gt; <a href="../../../caqti/Caqti_error/index.html#type-call">Caqti_error.call</a> ]</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p>Set or clear the timeout after which a running SQL statement will be terminated if supported by the driver. This is currently supported for MariaDB (using <code>max_statement_time</code>) and PostgreSQL (using <code>statement_timeout</code>) and has no effect for SQLite3.</p></div></div><h3 id="transactions"><a href="#transactions" class="anchor"></a>Transactions</h3><div class="odoc-spec"><div class="spec value anchored" id="val-start"><a href="#val-start" class="anchor"></a><code><span><span class="keyword">val</span> start : 
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(unit, <span>[&gt; <a href="../../../caqti/Caqti_error/index.html#type-transact">Caqti_error.transact</a> ]</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p>Starts a transaction if supported by the underlying database, otherwise does nothing.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-commit"><a href="#val-commit" class="anchor"></a><code><span><span class="keyword">val</span> commit : 
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(unit, <span>[&gt; <a href="../../../caqti/Caqti_error/index.html#type-transact">Caqti_error.transact</a> ]</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p>Commits the current transaction if supported by the underlying database, otherwise does nothing.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-rollback"><a href="#val-rollback" class="anchor"></a><code><span><span class="keyword">val</span> rollback : 
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(unit, <span>[&gt; <a href="../../../caqti/Caqti_error/index.html#type-transact">Caqti_error.transact</a> ]</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p>Rolls back a transaction if supported by the underlying database, otherwise does nothing.</p></div></div><h3 id="disconnection-and-reuse"><a href="#disconnection-and-reuse" class="anchor"></a>Disconnection and Reuse</h3><div class="odoc-spec"><div class="spec value anchored" id="val-deallocate"><a href="#val-deallocate" class="anchor"></a><code><span><span class="keyword">val</span> deallocate : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'m</span>)</span> <a href="../../../caqti/Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(unit, <span>[&gt; <a href="../../../caqti/Caqti_error/index.html#type-call">Caqti_error.call</a> ]</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p><code>deallocate req</code> deallocates the prepared query for <code>req</code> if it was allocated. The request must not be oneshot.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-disconnect"><a href="#val-disconnect" class="anchor"></a><code><span><span class="keyword">val</span> disconnect : <span>unit <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p>Calling <code>disconnect ()</code> closes the connection to the database and frees up related resources.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-validate"><a href="#val-validate" class="anchor"></a><code><span><span class="keyword">val</span> validate : <span>unit <span class="arrow">&#45;&gt;</span></span> <span>bool <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p>For internal use by pool implementations. Tries to ensure the validity of the connection and must return <code>false</code> if unsuccessful.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-check"><a href="#val-check" class="anchor"></a><code><span><span class="keyword">val</span> check : <span><span>(<span>bool <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>For internal use by pool implementations. Called after a connection has been used. <code>check f</code> must call <code>f ()</code> exactly once with an argument indicating whether to keep the connection in the pool or discard it.</p></div></div></details></div><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="../../../caqti/Caqti_connection_sig/module-type-Convenience/index.html">Caqti_connection_sig.Convenience</a>
  <span class="keyword">with</span> <span><span class="keyword">type</span> <span>'a <a href="../../../caqti/Caqti_connection_sig/module-type-Convenience/index.html#type-fiber">fiber</a></span> := <span><span class="type-var">'a</span> <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></span></code></summary><h3 id="retrieval-convenience"><a href="#retrieval-convenience" class="anchor"></a>Retrieval Convenience</h3><p>Each of these shortcuts combine <code>call</code> with the correspondingly named retrieval function from <a href="../../../caqti/Caqti_response_sig/module-type-S/index.html"><code>Caqti_response_sig.S</code></a>.</p><div class="odoc-spec"><div class="spec value anchored" id="val-exec"><a href="#val-exec" class="anchor"></a><code><span><span class="keyword">val</span> exec : 
  <span><span><span>(<span class="type-var">'a</span>, unit, <span>[&lt; `Zero ]</span>)</span> <a href="../../../caqti/Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(unit, <span>[&gt; <a href="../../../caqti/Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e)</span> <span class="xref-unresolved">Stdlib</span>.result</span>
    <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p><code>exec req x</code> performs <code>req</code> with parameters <code>x</code> and checks that no rows are returned. See also <a href="../../../caqti/Caqti_response_sig/module-type-S/index.html#val-exec"><code>Caqti_response_sig.S.exec</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-exec_with_affected_count"><a href="#val-exec_with_affected_count" class="anchor"></a><code><span><span class="keyword">val</span> exec_with_affected_count : 
  <span><span><span>(<span class="type-var">'a</span>, unit, <span>[&lt; `Zero ]</span>)</span> <a href="../../../caqti/Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(int, <span>[&gt; <a href="../../../caqti/Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> <span>| `Unsupported</span> ]</span> <span class="keyword">as</span> 'e)</span> <span class="xref-unresolved">Stdlib</span>.result</span>
    <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p><code>exec_with_affected_count req x</code> performs <code>req</code> with parameters <code>x</code>, checks that no rows are returned, and returns the number of affected rows.</p><p>See also <a href="../../../caqti/Caqti_response_sig/module-type-S/index.html#val-exec"><code>Caqti_response_sig.S.exec</code></a> and <a href="../../../caqti/Caqti_response_sig/module-type-S/index.html#val-affected_count"><code>Caqti_response_sig.S.affected_count</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find"><a href="#val-find" class="anchor"></a><code><span><span class="keyword">val</span> find : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `One ]</span>)</span> <a href="../../../caqti/Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'b</span>, <span>[&gt; <a href="../../../caqti/Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e)</span> <span class="xref-unresolved">Stdlib</span>.result</span>
    <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p><code>find req x</code> performs <code>req</code> with parameters <code>x</code>, checks that a single row is retured, and returns it.</p><p>See also <a href="../../../caqti/Caqti_response_sig/module-type-S/index.html#val-find"><code>Caqti_response_sig.S.find</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_opt"><a href="#val-find_opt" class="anchor"></a><code><span><span class="keyword">val</span> find_opt : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `Zero <span>| `One</span> ]</span>)</span> <a href="../../../caqti/Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span><span class="type-var">'b</span> option</span>, <span>[&gt; <a href="../../../caqti/Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e)</span> <span class="xref-unresolved">Stdlib</span>.result</span>
    <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p><code>find_opt req x</code> performs <code>req</code> with parameters <code>x</code> and returns either <code>None</code> if no rows are returned or <code>Some y</code> if a single now <code>y</code> is returned and fails otherwise.</p><p>See also <a href="../../../caqti/Caqti_response_sig/module-type-S/index.html#val-find_opt"><code>Caqti_response_sig.S.find_opt</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fold"><a href="#val-fold" class="anchor"></a><code><span><span class="keyword">val</span> fold : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `Zero <span>| `One</span> <span>| `Many</span> ]</span>)</span> <a href="../../../caqti/Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'c</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'c</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'c</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'c</span>, <span>[&gt; <a href="../../../caqti/Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e)</span> <span class="xref-unresolved">Stdlib</span>.result</span>
    <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p><code>fold req f x acc</code> performs <code>req</code> with parameters <code>x</code> and passes <code>acc</code> through the composition of <code>f y</code> across the result rows <code>y</code> in the order of retrieval.</p><p>See also <a href="../../../caqti/Caqti_response_sig/module-type-S/index.html#val-fold"><code>Caqti_response_sig.S.fold</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fold_s"><a href="#val-fold_s" class="anchor"></a><code><span><span class="keyword">val</span> fold_s : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `Zero <span>| `One</span> <span>| `Many</span> ]</span>)</span> <a href="../../../caqti/Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'c</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'c</span>, <span class="type-var">'e</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'c</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'c</span>, <span>[&gt; <a href="../../../caqti/Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e)</span> <span class="xref-unresolved">Stdlib</span>.result</span>
    <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p><code>fold_s req f x acc</code> performs <code>req</code> with parameters <code>x</code> and passes <code>acc</code> through the monadic composition of <code>f y</code> across the returned rows <code>y</code> in the order of retrieval.</p><p>Please be aware of possible deadlocks when using resources from the callback. In particular, if the same connection pool is invoked as the one used to obtain the current connection, it will deadlock if the pool has just run out of connections. An alternative is to collect the rows first e.g. with <a href="#val-fold"><code>fold</code></a> and do the nested queries after exiting.</p><p>See also <a href="../../../caqti/Caqti_response_sig/module-type-S/index.html#val-fold_s"><code>Caqti_response_sig.S.fold_s</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-iter_s"><a href="#val-iter_s" class="anchor"></a><code><span><span class="keyword">val</span> iter_s : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `Zero <span>| `One</span> <span>| `Many</span> ]</span>)</span> <a href="../../../caqti/Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(unit, <span class="type-var">'e</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(unit, <span>[&gt; <a href="../../../caqti/Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e)</span> <span class="xref-unresolved">Stdlib</span>.result</span>
    <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p><code>iter_s req f x</code> performs <code>req</code> with parameters <code>x</code> and sequences calls to <code>f y</code> for each result row <code>y</code> in the order of retrieval.</p><p>Please see the warning in <a href="#val-fold_s"><code>fold_s</code></a> about resource usage in the callback.</p><p>See also <a href="../../../caqti/Caqti_response_sig/module-type-S/index.html#val-iter_s"><code>Caqti_response_sig.S.iter_s</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-collect_list"><a href="#val-collect_list" class="anchor"></a><code><span><span class="keyword">val</span> collect_list : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `Zero <span>| `One</span> <span>| `Many</span> ]</span>)</span> <a href="../../../caqti/Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span><span class="type-var">'b</span> list</span>, <span>[&gt; <a href="../../../caqti/Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e)</span> <span class="xref-unresolved">Stdlib</span>.result</span>
    <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p><code>collect_list request x</code> performs a <code>req</code> with parameters <code>x</code> and returns a list of rows in order of retrieval. The accumulation is tail recursive but slightly less efficient than <a href="#val-rev_collect_list"><code>rev_collect_list</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-rev_collect_list"><a href="#val-rev_collect_list" class="anchor"></a><code><span><span class="keyword">val</span> rev_collect_list : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `Zero <span>| `One</span> <span>| `Many</span> ]</span>)</span> <a href="../../../caqti/Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span><span class="type-var">'b</span> list</span>, <span>[&gt; <a href="../../../caqti/Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e)</span> <span class="xref-unresolved">Stdlib</span>.result</span>
    <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p><code>rev_collect_list request x</code> performs <code>request</code> with parameters <code>x</code> and returns a list of rows in the reverse order of retrieval. The accumulation is tail recursive and slighly more efficient than <a href="#val-collect_list"><code>collect_list</code></a>.</p></div></div><h3 id="transactions_2"><a href="#transactions_2" class="anchor"></a>Transactions</h3><div class="odoc-spec"><div class="spec value anchored" id="val-with_transaction"><a href="#val-with_transaction" class="anchor"></a><code><span><span class="keyword">val</span> with_transaction : 
  <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'e</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span>[&gt; <a href="../../../caqti/Caqti_error/index.html#type-transact">Caqti_error.transact</a> ]</span> <span class="keyword">as</span> 'e)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p><code>with_transaction f</code> wraps <code>f</code> in a transaction which is committed iff <code>f</code> returns <code>Ok _</code>.</p></div></div></details></div><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="../../../caqti/Caqti_connection_sig/module-type-Populate/index.html">Caqti_connection_sig.Populate</a>
  <span class="keyword">with</span> <span><span class="keyword">type</span> <span>'a <a href="../../../caqti/Caqti_connection_sig/module-type-Populate/index.html#type-fiber">fiber</a></span> := <span><span class="type-var">'a</span> <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span>
   <span class="keyword">and</span> <span><span class="keyword">type</span> <span>('a, 'err) <a href="../../../caqti/Caqti_connection_sig/module-type-Populate/index.html#type-stream">stream</a></span> := <span><span>(<span class="type-var">'a</span>, <span class="type-var">'err</span>)</span> <a href="../Stream/index.html#type-t">Stream.t</a></span></span></span></code></summary><h3 id="insertion"><a href="#insertion" class="anchor"></a>Insertion</h3><div class="odoc-spec"><div class="spec value anchored" id="val-populate"><a href="#val-populate" class="anchor"></a><code><span><span class="keyword">val</span> populate : 
  <span><span class="label">table</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">columns</span>:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../../../caqti/Caqti_type/index.html#type-t">Caqti_type.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'err</span>)</span> <a href="../Stream/index.html#type-t">Stream.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(unit, <span>[&gt; <a href="../../../caqti/Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> <span><span>| `Congested</span> of <span class="type-var">'err</span></span> ]</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span>
    <span class="xref-unresolved">Async_kernel</span>.Deferred.t</span></span></code></div><div class="spec-doc"><p><code>populate table columns row_type seq</code> inputs the contents of <code>seq</code> into the database in whatever manner is most efficient as decided by the driver.</p></div></div></details></div></div></body></html>
