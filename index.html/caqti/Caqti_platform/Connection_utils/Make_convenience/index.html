<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Make_convenience (caqti.Caqti_platform.Connection_utils.Make_convenience)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">caqti</a> &#x00BB; <a href="../../index.html">Caqti_platform</a> &#x00BB; <a href="../index.html">Connection_utils</a> &#x00BB; Make_convenience</nav><header class="odoc-preamble"><h1>Module <code><span>Connection_utils.Make_convenience</span></code></h1></header><nav class="odoc-toc"><ul><li><a href="#parameters">Parameters</a></li><li><a href="#signature">Signature</a><ul><li><a href="#retrieval-convenience">Retrieval Convenience</a></li><li><a href="#transactions">Transactions</a></li></ul></li></ul></nav><div class="odoc-content"><h2 id="parameters"><a href="#parameters" class="anchor"></a>Parameters</h2><div class="odoc-spec"><div class="spec parameter anchored" id="argument-1-Sys"><a href="#argument-1-Sys" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="argument-1-Sys/index.html">Sys</a></span><span> : <a href="../../System_sig/module-type-S/index.html">System_sig.S</a></span></code></div></div><div class="odoc-spec"><div class="spec parameter anchored" id="argument-2-_"><a href="#argument-2-_" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="argument-2-_/index.html">_</a></span><span> : 
  <a href="../../../Caqti_connection_sig/module-type-Base/index.html">Caqti_connection_sig.Base</a>
    <span class="keyword">with</span> <span><span class="keyword">type</span> <span>'a <a href="../../../Caqti_connection_sig/module-type-Base/index.html#type-fiber">fiber</a></span> := <span><span class="type-var">'a</span> <a href="argument-1-Sys/Fiber/index.html#type-t">Sys.Fiber.t</a></span></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <span>('a, 'err) <a href="../../../Caqti_connection_sig/module-type-Base/index.html#type-stream">stream</a></span> := <span><span>(<span class="type-var">'a</span>, <span class="type-var">'err</span>)</span> <a href="argument-1-Sys/Stream/index.html#type-t">Sys.Stream.t</a></span></span></span></code></div></div><h2 id="signature"><a href="#signature" class="anchor"></a>Signature</h2><h3 id="retrieval-convenience"><a href="#retrieval-convenience" class="anchor"></a>Retrieval Convenience</h3><p>Each of these shortcuts combine <code>call</code> with the correspondingly named retrieval function from <a href="../../../Caqti_response_sig/module-type-S/index.html"><code>Caqti_response_sig.S</code></a>.</p><div class="odoc-spec"><div class="spec value anchored" id="val-exec"><a href="#val-exec" class="anchor"></a><code><span><span class="keyword">val</span> exec : 
  <span><span><span>(<span class="type-var">'a</span>, unit, <span>[&lt; `Zero ]</span>)</span> <a href="../../../Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(unit, <span>[&gt; <a href="../../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <a href="argument-1-Sys/Fiber/index.html#type-t">Sys.Fiber.t</a></span></span></code></div><div class="spec-doc"><p><code>exec req x</code> performs <code>req</code> with parameters <code>x</code> and checks that no rows are returned. See also <a href="../../../Caqti_response_sig/module-type-S/index.html#val-exec"><code>Caqti_response_sig.S.exec</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-exec_with_affected_count"><a href="#val-exec_with_affected_count" class="anchor"></a><code><span><span class="keyword">val</span> exec_with_affected_count : 
  <span><span><span>(<span class="type-var">'a</span>, unit, <span>[&lt; `Zero ]</span>)</span> <a href="../../../Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(int, <span>[&gt; <a href="../../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> <span>| `Unsupported</span> ]</span> <span class="keyword">as</span> 'e)</span> <span class="xref-unresolved">Stdlib</span>.result</span>
    <a href="argument-1-Sys/Fiber/index.html#type-t">Sys.Fiber.t</a></span></span></code></div><div class="spec-doc"><p><code>exec_with_affected_count req x</code> performs <code>req</code> with parameters <code>x</code>, checks that no rows are returned, and returns the number of affected rows.</p><p>See also <a href="../../../Caqti_response_sig/module-type-S/index.html#val-exec"><code>Caqti_response_sig.S.exec</code></a> and <a href="../../../Caqti_response_sig/module-type-S/index.html#val-affected_count"><code>Caqti_response_sig.S.affected_count</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find"><a href="#val-find" class="anchor"></a><code><span><span class="keyword">val</span> find : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `One ]</span>)</span> <a href="../../../Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'b</span>, <span>[&gt; <a href="../../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <a href="argument-1-Sys/Fiber/index.html#type-t">Sys.Fiber.t</a></span></span></code></div><div class="spec-doc"><p><code>find req x</code> performs <code>req</code> with parameters <code>x</code>, checks that a single row is retured, and returns it.</p><p>See also <a href="../../../Caqti_response_sig/module-type-S/index.html#val-find"><code>Caqti_response_sig.S.find</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_opt"><a href="#val-find_opt" class="anchor"></a><code><span><span class="keyword">val</span> find_opt : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `Zero <span>| `One</span> ]</span>)</span> <a href="../../../Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span><span class="type-var">'b</span> option</span>, <span>[&gt; <a href="../../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e)</span> <span class="xref-unresolved">Stdlib</span>.result</span>
    <a href="argument-1-Sys/Fiber/index.html#type-t">Sys.Fiber.t</a></span></span></code></div><div class="spec-doc"><p><code>find_opt req x</code> performs <code>req</code> with parameters <code>x</code> and returns either <code>None</code> if no rows are returned or <code>Some y</code> if a single now <code>y</code> is returned and fails otherwise.</p><p>See also <a href="../../../Caqti_response_sig/module-type-S/index.html#val-find_opt"><code>Caqti_response_sig.S.find_opt</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fold"><a href="#val-fold" class="anchor"></a><code><span><span class="keyword">val</span> fold : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `Zero <span>| `One</span> <span>| `Many</span> ]</span>)</span> <a href="../../../Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'c</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'c</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'c</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'c</span>, <span>[&gt; <a href="../../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <a href="argument-1-Sys/Fiber/index.html#type-t">Sys.Fiber.t</a></span></span></code></div><div class="spec-doc"><p><code>fold req f x acc</code> performs <code>req</code> with parameters <code>x</code> and passes <code>acc</code> through the composition of <code>f y</code> across the result rows <code>y</code> in the order of retrieval.</p><p>See also <a href="../../../Caqti_response_sig/module-type-S/index.html#val-fold"><code>Caqti_response_sig.S.fold</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fold_s"><a href="#val-fold_s" class="anchor"></a><code><span><span class="keyword">val</span> fold_s : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `Zero <span>| `One</span> <span>| `Many</span> ]</span>)</span> <a href="../../../Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'c</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'c</span>, <span class="type-var">'e</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <a href="argument-1-Sys/Fiber/index.html#type-t">Sys.Fiber.t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'c</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'c</span>, <span>[&gt; <a href="../../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <a href="argument-1-Sys/Fiber/index.html#type-t">Sys.Fiber.t</a></span></span></code></div><div class="spec-doc"><p><code>fold_s req f x acc</code> performs <code>req</code> with parameters <code>x</code> and passes <code>acc</code> through the monadic composition of <code>f y</code> across the returned rows <code>y</code> in the order of retrieval.</p><p>Please be aware of possible deadlocks when using resources from the callback. In particular, if the same connection pool is invoked as the one used to obtain the current connection, it will deadlock if the pool has just run out of connections. An alternative is to collect the rows first e.g. with <a href="#val-fold"><code>fold</code></a> and do the nested queries after exiting.</p><p>See also <a href="../../../Caqti_response_sig/module-type-S/index.html#val-fold_s"><code>Caqti_response_sig.S.fold_s</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-iter_s"><a href="#val-iter_s" class="anchor"></a><code><span><span class="keyword">val</span> iter_s : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `Zero <span>| `One</span> <span>| `Many</span> ]</span>)</span> <a href="../../../Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(unit, <span class="type-var">'e</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <a href="argument-1-Sys/Fiber/index.html#type-t">Sys.Fiber.t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(unit, <span>[&gt; <a href="../../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <a href="argument-1-Sys/Fiber/index.html#type-t">Sys.Fiber.t</a></span></span></code></div><div class="spec-doc"><p><code>iter_s req f x</code> performs <code>req</code> with parameters <code>x</code> and sequences calls to <code>f y</code> for each result row <code>y</code> in the order of retrieval.</p><p>Please see the warning in <a href="#val-fold_s"><code>fold_s</code></a> about resource usage in the callback.</p><p>See also <a href="../../../Caqti_response_sig/module-type-S/index.html#val-iter_s"><code>Caqti_response_sig.S.iter_s</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-collect_list"><a href="#val-collect_list" class="anchor"></a><code><span><span class="keyword">val</span> collect_list : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `Zero <span>| `One</span> <span>| `Many</span> ]</span>)</span> <a href="../../../Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span><span class="type-var">'b</span> list</span>, <span>[&gt; <a href="../../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <a href="argument-1-Sys/Fiber/index.html#type-t">Sys.Fiber.t</a></span></span></code></div><div class="spec-doc"><p><code>collect_list request x</code> performs a <code>req</code> with parameters <code>x</code> and returns a list of rows in order of retrieval. The accumulation is tail recursive but slightly less efficient than <a href="#val-rev_collect_list"><code>rev_collect_list</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-rev_collect_list"><a href="#val-rev_collect_list" class="anchor"></a><code><span><span class="keyword">val</span> rev_collect_list : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span>[&lt; `Zero <span>| `One</span> <span>| `Many</span> ]</span>)</span> <a href="../../../Caqti_request/index.html#type-t">Caqti_request.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span><span class="type-var">'b</span> list</span>, <span>[&gt; <a href="../../../Caqti_error/index.html#type-call_or_retrieve">Caqti_error.call_or_retrieve</a> ]</span> <span class="keyword">as</span> 'e)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <a href="argument-1-Sys/Fiber/index.html#type-t">Sys.Fiber.t</a></span></span></code></div><div class="spec-doc"><p><code>rev_collect_list request x</code> performs <code>request</code> with parameters <code>x</code> and returns a list of rows in the reverse order of retrieval. The accumulation is tail recursive and slighly more efficient than <a href="#val-collect_list"><code>collect_list</code></a>.</p></div></div><h3 id="transactions"><a href="#transactions" class="anchor"></a>Transactions</h3><div class="odoc-spec"><div class="spec value anchored" id="val-with_transaction"><a href="#val-with_transaction" class="anchor"></a><code><span><span class="keyword">val</span> with_transaction : 
  <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'e</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <a href="argument-1-Sys/Fiber/index.html#type-t">Sys.Fiber.t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span>[&gt; <a href="../../../Caqti_error/index.html#type-transact">Caqti_error.transact</a> ]</span> <span class="keyword">as</span> 'e)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <a href="argument-1-Sys/Fiber/index.html#type-t">Sys.Fiber.t</a></span></span></code></div><div class="spec-doc"><p><code>with_transaction f</code> wraps <code>f</code> in a transaction which is committed iff <code>f</code> returns <code>Ok _</code>.</p></div></div></div></body></html>
